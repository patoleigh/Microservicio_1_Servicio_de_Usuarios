{"openapi":"3.1.0","info":{"title":"moderation service api","description":"servicio de moderación de lenguaje para chat","version":"1.0.1"},"paths":{"/api/v1/health":{"get":{"tags":["health"],"summary":"Health Check","description":"Verifica el estado del servicio y sus dependencias","operationId":"health_check_api_v1_health_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HealthResponse"}}}}}}},"/api/v1/ping":{"get":{"tags":["health"],"summary":"Ping","description":"Endpoint simple para verificar que el servicio está vivo","operationId":"ping_api_v1_ping_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/v1/moderation/check":{"post":{"tags":["moderation"],"summary":"Moderar Mensaje","description":"Modera un mensaje y aplica strikes si es necesario","operationId":"moderate_message_api_v1_moderation_check_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ModerateMessageRequest"}}},"required":true},"responses":{"200":{"description":"Mensaje moderado exitosamente","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ModerateMessageResponse"}}}},"400":{"description":"Request inválido","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"429":{"description":"Rate limit excedido"},"500":{"description":"Error del servidor","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/moderation/analyze":{"post":{"tags":["moderation"],"summary":"Analizar Texto","description":"Analiza un texto sin aplicar strikes (solo análisis)","operationId":"analyze_text_api_v1_moderation_analyze_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/AnalyzeTextRequest"}}},"required":true},"responses":{"200":{"description":"Texto analizado exitosamente","content":{"application/json":{"schema":{"$ref":"#/components/schemas/AnalyzeTextResponse"}}}},"400":{"description":"Request inválido","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"500":{"description":"Error del servidor","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/moderation/status/{user_id}/{channel_id}":{"get":{"tags":["moderation"],"summary":"Estado de Usuario","description":"Obtiene el estado de moderación de un usuario en un canal","operationId":"get_user_moderation_status_api_v1_moderation_status__user_id___channel_id__get","parameters":[{"name":"user_id","in":"path","required":true,"schema":{"type":"string","title":"User Id"}},{"name":"channel_id","in":"path","required":true,"schema":{"type":"string","title":"Channel Id"}}],"responses":{"200":{"description":"Estado obtenido exitosamente","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ModerationStatusResponse"}}}},"404":{"description":"Usuario no encontrado"},"500":{"description":"Error del servidor","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/blacklist/words":{"post":{"tags":["blacklist"],"summary":"Agregar Palabra","description":"Agrega una palabra a la lista negra","operationId":"add_word_api_v1_blacklist_words_post","parameters":[{"name":"x-api-key","in":"header","required":false,"schema":{"type":"string","description":"API Key para autenticación","title":"X-Api-Key"},"description":"API Key para autenticación"}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/AddWordRequest"}}}},"responses":{"201":{"description":"Palabra agregada exitosamente","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SuccessResponse"}}}},"400":{"description":"Request inválido","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"401":{"description":"No autorizado"},"500":{"description":"Error del servidor","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"get":{"tags":["blacklist"],"summary":"Listar Palabras","description":"Obtiene palabras de la lista negra","operationId":"get_words_api_v1_blacklist_words_get","parameters":[{"name":"language","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Filtrar por idioma","title":"Language"},"description":"Filtrar por idioma"},{"name":"category","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Filtrar por categoría","title":"Category"},"description":"Filtrar por categoría"},{"name":"severity","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Filtrar por severidad","title":"Severity"},"description":"Filtrar por severidad"},{"name":"limit","in":"query","required":false,"schema":{"type":"integer","maximum":100,"minimum":1,"description":"Límite de resultados","default":50,"title":"Limit"},"description":"Límite de resultados"},{"name":"skip","in":"query","required":false,"schema":{"type":"integer","minimum":0,"description":"Documentos a saltar","default":0,"title":"Skip"},"description":"Documentos a saltar"}],"responses":{"200":{"description":"Lista obtenida exitosamente","content":{"application/json":{"schema":{"$ref":"#/components/schemas/BlacklistWordsResponse"}}}},"500":{"description":"Error del servidor","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/blacklist/words/{word_id}":{"delete":{"tags":["blacklist"],"summary":"Eliminar Palabra","description":"Elimina (desactiva) una palabra de la lista negra","operationId":"delete_word_api_v1_blacklist_words__word_id__delete","parameters":[{"name":"word_id","in":"path","required":true,"schema":{"type":"string","title":"Word Id"}},{"name":"x-api-key","in":"header","required":false,"schema":{"type":"string","description":"API Key para autenticación","title":"X-Api-Key"},"description":"API Key para autenticación"}],"responses":{"200":{"description":"Palabra eliminada exitosamente","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SuccessResponse"}}}},"401":{"description":"No autorizado"},"404":{"description":"Palabra no encontrada"},"500":{"description":"Error del servidor","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/blacklist/stats":{"get":{"tags":["blacklist"],"summary":"Estadísticas","description":"Obtiene estadísticas de la lista negra","operationId":"get_blacklist_stats_api_v1_blacklist_stats_get","responses":{"200":{"description":"Estadísticas obtenidas exitosamente","content":{"application/json":{"schema":{"$ref":"#/components/schemas/BlacklistStatsResponse"}}}},"500":{"description":"Error del servidor","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}}}}},"/api/v1/blacklist/refresh-cache":{"post":{"tags":["blacklist"],"summary":"Refrescar Cache","description":"Fuerza la actualización del cache de lista negra","operationId":"refresh_cache_api_v1_blacklist_refresh_cache_post","parameters":[{"name":"x-api-key","in":"header","required":false,"schema":{"type":"string","description":"API Key para autenticación","title":"X-Api-Key"},"description":"API Key para autenticación"}],"responses":{"200":{"description":"Cache refrescado exitosamente","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SuccessResponse"}}}},"401":{"description":"No autorizado"},"500":{"description":"Error del servidor","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/admin/banned-users":{"get":{"tags":["admin"],"summary":"Usuarios Baneados","description":"Obtiene lista de usuarios baneados","operationId":"get_banned_users_api_v1_admin_banned_users_get","parameters":[{"name":"channel_id","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Filtrar por canal","title":"Channel Id"},"description":"Filtrar por canal"},{"name":"x-api-key","in":"header","required":false,"schema":{"type":"string","description":"API Key para autenticación","title":"X-Api-Key"},"description":"API Key para autenticación"}],"responses":{"200":{"description":"Lista obtenida exitosamente","content":{"application/json":{"schema":{"$ref":"#/components/schemas/BannedUsersResponse"}}}},"401":{"description":"No autorizado"},"500":{"description":"Error del servidor","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/admin/users/{user_id}/violations":{"get":{"tags":["admin"],"summary":"Historial de Violaciones","description":"Obtiene el historial de violaciones de un usuario","operationId":"get_user_violations_api_v1_admin_users__user_id__violations_get","parameters":[{"name":"user_id","in":"path","required":true,"schema":{"type":"string","title":"User Id"}},{"name":"channel_id","in":"query","required":true,"schema":{"type":"string","description":"ID del canal","title":"Channel Id"},"description":"ID del canal"},{"name":"limit","in":"query","required":false,"schema":{"type":"integer","maximum":100,"minimum":1,"description":"Límite de resultados","default":50,"title":"Limit"},"description":"Límite de resultados"},{"name":"x-api-key","in":"header","required":false,"schema":{"type":"string","description":"API Key para autenticación","title":"X-Api-Key"},"description":"API Key para autenticación"}],"responses":{"200":{"description":"Historial obtenido exitosamente","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserViolationsResponse"}}}},"401":{"description":"No autorizado"},"404":{"description":"Usuario no encontrado"},"500":{"description":"Error del servidor","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/admin/users/{user_id}/unban":{"put":{"tags":["admin"],"summary":"Desbanear Usuario","description":"Desbanea a un usuario de un canal","operationId":"unban_user_api_v1_admin_users__user_id__unban_put","parameters":[{"name":"user_id","in":"path","required":true,"schema":{"type":"string","title":"User Id"}},{"name":"x-api-key","in":"header","required":false,"schema":{"type":"string","description":"API Key para autenticación","title":"X-Api-Key"},"description":"API Key para autenticación"}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UnbanUserRequest"}}}},"responses":{"200":{"description":"Usuario desbaneado exitosamente","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SuccessResponse"}}}},"401":{"description":"No autorizado"},"404":{"description":"Usuario o ban no encontrado"},"500":{"description":"Error del servidor","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/admin/users/{user_id}/status":{"get":{"tags":["admin"],"summary":"Estado Completo de Usuario","description":"Obtiene el estado completo de moderación de un usuario","operationId":"get_user_full_status_api_v1_admin_users__user_id__status_get","parameters":[{"name":"user_id","in":"path","required":true,"schema":{"type":"string","title":"User Id"}},{"name":"channel_id","in":"query","required":true,"schema":{"type":"string","description":"ID del canal","title":"Channel Id"},"description":"ID del canal"},{"name":"x-api-key","in":"header","required":false,"schema":{"type":"string","description":"API Key para autenticación","title":"X-Api-Key"},"description":"API Key para autenticación"}],"responses":{"200":{"description":"Estado obtenido exitosamente","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserStatusResponse"}}}},"401":{"description":"No autorizado"},"404":{"description":"Usuario no encontrado"},"500":{"description":"Error del servidor","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/admin/users/{user_id}/reset-strikes":{"post":{"tags":["admin"],"summary":"Resetear Strikes","description":"Resetea los strikes de un usuario","operationId":"reset_user_strikes_api_v1_admin_users__user_id__reset_strikes_post","parameters":[{"name":"user_id","in":"path","required":true,"schema":{"type":"string","title":"User Id"}},{"name":"channel_id","in":"query","required":true,"schema":{"type":"string","description":"ID del canal","title":"Channel Id"},"description":"ID del canal"},{"name":"x-api-key","in":"header","required":false,"schema":{"type":"string","description":"API Key para autenticación","title":"X-Api-Key"},"description":"API Key para autenticación"}],"responses":{"200":{"description":"Strikes reseteados exitosamente","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SuccessResponse"}}}},"401":{"description":"No autorizado"},"404":{"description":"Usuario no encontrado"},"500":{"description":"Error del servidor","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/admin/channels/{channel_id}/stats":{"get":{"tags":["admin"],"summary":"Estadísticas de Canal","description":"Obtiene estadísticas de moderación de un canal","operationId":"get_channel_stats_api_v1_admin_channels__channel_id__stats_get","parameters":[{"name":"channel_id","in":"path","required":true,"schema":{"type":"string","title":"Channel Id"}},{"name":"x-api-key","in":"header","required":false,"schema":{"type":"string","description":"API Key para autenticación","title":"X-Api-Key"},"description":"API Key para autenticación"}],"responses":{"200":{"description":"Estadísticas obtenidas exitosamente","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ChannelStatsResponse"}}}},"401":{"description":"No autorizado"},"500":{"description":"Error del servidor","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/admin/maintenance/expire-bans":{"post":{"tags":["admin"],"summary":"Expirar Bans","description":"Verifica y expira bans temporales vencidos (tarea de mantenimiento)","operationId":"expire_bans_api_v1_admin_maintenance_expire_bans_post","parameters":[{"name":"x-api-key","in":"header","required":false,"schema":{"type":"string","description":"API Key para autenticación","title":"X-Api-Key"},"description":"API Key para autenticación"}],"responses":{"200":{"description":"Tarea ejecutada exitosamente","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SuccessResponse"}}}},"401":{"description":"No autorizado"},"500":{"description":"Error del servidor","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/":{"get":{"tags":["root"],"summary":"Root","description":"Root endpoint","operationId":"root__get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}}},"components":{"schemas":{"AddWordRequest":{"properties":{"word":{"type":"string","maxLength":200,"minLength":1,"title":"Word","description":"Palabra o patrón a agregar"},"language":{"type":"string","maxLength":5,"minLength":2,"title":"Language","description":"Código ISO del idioma"},"category":{"type":"string","title":"Category","description":"Categoría: insult, profanity, hate_speech, threat, harassment, other"},"severity":{"type":"string","title":"Severity","description":"Severidad: low, medium, high"},"is_regex":{"type":"boolean","title":"Is Regex","description":"Si es expresión regular","default":false},"notes":{"anyOf":[{"type":"string","maxLength":500},{"type":"null"}],"title":"Notes","description":"Notas adicionales"}},"type":"object","required":["word","language","category","severity"],"title":"AddWordRequest","description":"Request para agregar palabra a lista negra","example":{"category":"insult","is_regex":false,"language":"es","notes":"Insulto común en español","severity":"medium","word":"idiota"}},"AnalyzeTextRequest":{"properties":{"text":{"type":"string","maxLength":5000,"minLength":1,"title":"Text","description":"Texto a analizar"},"language":{"anyOf":[{"type":"string","maxLength":5,"minLength":2},{"type":"null"}],"title":"Language","description":"Código ISO del idioma (opcional, se detecta automáticamente)"}},"type":"object","required":["text"],"title":"AnalyzeTextRequest","description":"Request para analizar texto sin aplicar strikes","example":{"language":"es","text":"Este es un texto de prueba"}},"AnalyzeTextResponse":{"properties":{"is_toxic":{"type":"boolean","title":"Is Toxic","description":"Si el texto es tóxico"},"toxicity_score":{"type":"number","maximum":1.0,"minimum":0.0,"title":"Toxicity Score","description":"Score de toxicidad"},"severity":{"type":"string","title":"Severity","description":"Severidad: none, low, medium, high"},"language":{"type":"string","title":"Language","description":"Idioma detectado"},"detected_words":{"items":{"type":"string"},"type":"array","title":"Detected Words","description":"Palabras prohibidas detectadas"},"categories":{"items":{"type":"string"},"type":"array","title":"Categories","description":"Categorías de toxicidad detectadas"},"detoxify_scores":{"additionalProperties":{"type":"number"},"type":"object","title":"Detoxify Scores","description":"Scores detallados de Detoxify"}},"type":"object","required":["is_toxic","toxicity_score","severity","language"],"title":"AnalyzeTextResponse","description":"Response de análisis de texto","example":{"categories":["insult","obscene"],"detected_words":["idiota"],"detoxify_scores":{"identity_hate":0.03,"insult":0.92,"obscene":0.78,"severe_toxicity":0.12,"threat":0.05,"toxicity":0.85},"is_toxic":true,"language":"es","severity":"high","toxicity_score":0.85}},"BannedUserInfo":{"properties":{"user_id":{"type":"string","title":"User Id","description":"ID del usuario"},"channel_id":{"type":"string","title":"Channel Id","description":"ID del canal"},"ban_type":{"type":"string","title":"Ban Type","description":"Tipo: temporary o permanent"},"banned_at":{"type":"string","title":"Banned At","description":"Fecha de ban (ISO)"},"banned_until":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Banned Until","description":"Fecha de expiración (ISO)"},"reason":{"type":"string","title":"Reason","description":"Razón del ban"},"total_violations":{"type":"integer","minimum":0.0,"title":"Total Violations","description":"Total de violaciones"},"strike_count":{"type":"integer","minimum":0.0,"title":"Strike Count","description":"Strikes actuales"}},"type":"object","required":["user_id","channel_id","ban_type","banned_at","reason","total_violations","strike_count"],"title":"BannedUserInfo","description":"Información de usuario baneado","example":{"ban_type":"temporary","banned_at":"2025-10-13T10:00:00Z","banned_until":"2025-10-14T10:00:00Z","channel_id":"channel_abc","reason":"Excedió 3 strikes","strike_count":3,"total_violations":4,"user_id":"user_789"}},"BannedUsersResponse":{"properties":{"total":{"type":"integer","title":"Total","description":"Total de usuarios baneados"},"banned_users":{"items":{"$ref":"#/components/schemas/BannedUserInfo"},"type":"array","title":"Banned Users","description":"Lista de usuarios baneados"}},"type":"object","required":["total"],"title":"BannedUsersResponse","description":"Response con lista de usuarios baneados","example":{"banned_users":[{"ban_type":"temporary","banned_at":"2025-10-13T10:00:00Z","banned_until":"2025-10-14T10:00:00Z","channel_id":"channel_abc","reason":"Excedió 3 strikes","strike_count":3,"total_violations":4,"user_id":"user_789"}],"total":5}},"BlacklistStatsResponse":{"properties":{"total":{"type":"integer","title":"Total","description":"Total de palabras"},"active":{"type":"integer","title":"Active","description":"Palabras activas"},"inactive":{"type":"integer","title":"Inactive","description":"Palabras inactivas"},"by_language":{"additionalProperties":{"type":"integer"},"type":"object","title":"By Language","description":"Palabras por idioma"},"by_category":{"additionalProperties":{"type":"integer"},"type":"object","title":"By Category","description":"Palabras por categoría"},"by_severity":{"additionalProperties":{"type":"integer"},"type":"object","title":"By Severity","description":"Palabras por severidad"}},"type":"object","required":["total","active","inactive"],"title":"BlacklistStatsResponse","description":"Response con estadísticas de lista negra","example":{"active":480,"by_category":{"hate_speech":100,"insult":200,"profanity":150,"threat":50},"by_language":{"en":150,"es":200,"fr":50,"pt":100},"by_severity":{"high":150,"low":100,"medium":250},"inactive":20,"total":500}},"BlacklistWordsResponse":{"properties":{"total":{"type":"integer","title":"Total","description":"Total de palabras"},"words":{"items":{"$ref":"#/components/schemas/WordResponse"},"type":"array","title":"Words","description":"Lista de palabras"}},"type":"object","required":["total"],"title":"BlacklistWordsResponse","description":"Response con lista de palabras","example":{"total":150,"words":[{"added_at":"2025-10-13T10:00:00Z","added_by":"admin_123","category":"insult","id":"65f1a2b3c4d5e6f7g8h9i0j1","is_active":true,"is_regex":false,"language":"es","severity":"medium","updated_at":"2025-10-13T10:00:00Z","word":"idiota"}]}},"ChannelStatsResponse":{"properties":{"channel_id":{"type":"string","title":"Channel Id","description":"ID del canal"},"total_violations":{"type":"integer","minimum":0.0,"title":"Total Violations","description":"Total de violaciones"},"total_users_with_strikes":{"type":"integer","minimum":0.0,"title":"Total Users With Strikes","description":"Usuarios con strikes"},"banned_users":{"type":"integer","minimum":0.0,"title":"Banned Users","description":"Usuarios baneados"},"temp_banned":{"type":"integer","minimum":0.0,"title":"Temp Banned","description":"Bans temporales"},"perm_banned":{"type":"integer","minimum":0.0,"title":"Perm Banned","description":"Bans permanentes"},"avg_strikes":{"type":"number","minimum":0.0,"title":"Avg Strikes","description":"Promedio de strikes"}},"type":"object","required":["channel_id","total_violations","total_users_with_strikes","banned_users","temp_banned","perm_banned","avg_strikes"],"title":"ChannelStatsResponse","description":"Response con estadísticas de un canal","example":{"avg_strikes":2.3,"banned_users":8,"channel_id":"channel_abc","perm_banned":3,"temp_banned":5,"total_users_with_strikes":45,"total_violations":150}},"ErrorResponse":{"properties":{"error":{"type":"string","title":"Error","description":"Código de error"},"message":{"type":"string","title":"Message","description":"Mensaje de error"},"details":{"anyOf":[{"type":"object"},{"type":"null"}],"title":"Details","description":"Detalles adicionales del error"}},"type":"object","required":["error","message"],"title":"ErrorResponse","description":"Schema para respuestas de error","example":{"details":{"field":"user_id"},"error":"VALIDATION_ERROR","message":"Invalid user_id format"}},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"HealthResponse":{"properties":{"status":{"type":"string","title":"Status","description":"Estado del servicio"},"version":{"type":"string","title":"Version","description":"Versión del servicio"},"timestamp":{"type":"string","title":"Timestamp","description":"Timestamp ISO"},"dependencies":{"additionalProperties":{"type":"string"},"type":"object","title":"Dependencies","description":"Estado de dependencias"}},"type":"object","required":["status","version","timestamp"],"title":"HealthResponse","description":"Schema para health check","example":{"dependencies":{"mongodb":"connected","rabbitmq":"connected","redis":"connected"},"status":"healthy","timestamp":"2025-10-13T10:30:00Z","version":"1.0.0"}},"ModerateMessageRequest":{"properties":{"message_id":{"type":"string","maxLength":100,"minLength":3,"title":"Message Id","description":"ID único del mensaje"},"user_id":{"type":"string","maxLength":100,"minLength":3,"title":"User Id","description":"ID del usuario que envió el mensaje"},"channel_id":{"type":"string","maxLength":100,"minLength":3,"title":"Channel Id","description":"ID del canal donde se envió el mensaje"},"content":{"type":"string","maxLength":5000,"minLength":1,"title":"Content","description":"Contenido del mensaje a moderar"},"metadata":{"anyOf":[{"type":"object"},{"type":"null"}],"title":"Metadata","description":"Metadata adicional del mensaje"}},"type":"object","required":["message_id","user_id","channel_id","content"],"title":"ModerateMessageRequest","description":"Request para moderar un mensaje","example":{"channel_id":"channel_abc","content":"Este es un mensaje de prueba","message_id":"msg_123456","metadata":{"thread_id":"thread_001","timestamp":"2025-10-13T10:30:00Z"},"user_id":"user_789"}},"ModerateMessageResponse":{"properties":{"is_approved":{"type":"boolean","title":"Is Approved","description":"Si el mensaje fue aprobado"},"action":{"type":"string","title":"Action","description":"Acción tomada: approved, warning, temp_ban, perm_ban, blocked"},"severity":{"type":"string","title":"Severity","description":"Nivel de severidad: none, low, medium, high"},"toxicity_score":{"type":"number","maximum":1.0,"minimum":0.0,"title":"Toxicity Score","description":"Score de toxicidad (0-1)"},"strike_count":{"type":"integer","minimum":0.0,"title":"Strike Count","description":"Número actual de strikes del usuario"},"message":{"type":"string","title":"Message","description":"Mensaje descriptivo de la acción"},"detected_words":{"anyOf":[{"items":{"type":"string"},"type":"array"},{"type":"null"}],"title":"Detected Words","description":"Palabras prohibidas detectadas"},"language":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Language","description":"Idioma detectado del mensaje"},"ban_info":{"anyOf":[{"type":"object"},{"type":"null"}],"title":"Ban Info","description":"Información del ban si aplica"}},"type":"object","required":["is_approved","action","severity","toxicity_score","strike_count","message"],"title":"ModerateMessageResponse","description":"Response de moderación de mensaje","example":{"action":"warning","detected_words":["idiota"],"is_approved":false,"language":"es","message":"Advertencia. Strike 2/3","severity":"medium","strike_count":2,"toxicity_score":0.75}},"ModerationStatusResponse":{"properties":{"user_id":{"type":"string","title":"User Id","description":"ID del usuario"},"channel_id":{"type":"string","title":"Channel Id","description":"ID del canal"},"strike_count":{"type":"integer","minimum":0.0,"title":"Strike Count","description":"Strikes actuales"},"is_banned":{"type":"boolean","title":"Is Banned","description":"Si está baneado"},"ban_type":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Ban Type","description":"Tipo de ban: temporary o permanent"},"ban_expires_at":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Ban Expires At","description":"Fecha de expiración del ban (ISO)"},"strikes_reset_at":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Strikes Reset At","description":"Fecha de reset de strikes (ISO)"},"last_violation":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Last Violation","description":"Fecha de última violación (ISO)"}},"type":"object","required":["user_id","channel_id","strike_count","is_banned"],"title":"ModerationStatusResponse","description":"Response con estado de moderación de un usuario","example":{"channel_id":"channel_abc","is_banned":false,"last_violation":"2025-10-13T10:30:00Z","strike_count":2,"strikes_reset_at":"2025-11-12T10:30:00Z","user_id":"user_789"}},"SuccessResponse":{"properties":{"success":{"type":"boolean","title":"Success","description":"Indica éxito","default":true},"message":{"type":"string","title":"Message","description":"Mensaje descriptivo"},"data":{"anyOf":[{"type":"object"},{"type":"null"}],"title":"Data","description":"Datos adicionales"}},"type":"object","required":["message"],"title":"SuccessResponse","description":"Schema para respuestas exitosas simples","example":{"data":{"id":"123"},"message":"Operation completed successfully","success":true}},"UnbanUserRequest":{"properties":{"channel_id":{"type":"string","maxLength":100,"minLength":3,"title":"Channel Id","description":"ID del canal"},"reason":{"anyOf":[{"type":"string","maxLength":500},{"type":"null"}],"title":"Reason","description":"Razón del desbaneo"},"reset_strikes":{"type":"boolean","title":"Reset Strikes","description":"Si resetear los strikes también","default":false}},"type":"object","required":["channel_id"],"title":"UnbanUserRequest","description":"Request para desbanear usuario","example":{"channel_id":"channel_abc","reason":"Apelación aceptada","reset_strikes":false}},"UserStatusResponse":{"properties":{"user_id":{"type":"string","title":"User Id","description":"ID del usuario"},"channel_id":{"type":"string","title":"Channel Id","description":"ID del canal"},"strike_count":{"type":"integer","minimum":0.0,"title":"Strike Count","description":"Strikes actuales"},"is_banned":{"type":"boolean","title":"Is Banned","description":"Si está baneado"},"ban_info":{"anyOf":[{"type":"object"},{"type":"null"}],"title":"Ban Info","description":"Información del ban"},"violation_summary":{"type":"object","title":"Violation Summary","description":"Resumen de violaciones"}},"type":"object","required":["user_id","channel_id","strike_count","is_banned"],"title":"UserStatusResponse","description":"Response con estado completo del usuario","example":{"channel_id":"channel_abc","is_banned":false,"strike_count":2,"user_id":"user_789","violation_summary":{"by_severity":{"high":1,"low":1,"medium":1},"last_violation":"2025-10-13T10:30:00Z","total":3}}},"UserViolationsResponse":{"properties":{"user_id":{"type":"string","title":"User Id","description":"ID del usuario"},"channel_id":{"type":"string","title":"Channel Id","description":"ID del canal"},"total_violations":{"type":"integer","minimum":0.0,"title":"Total Violations","description":"Total de violaciones"},"current_strikes":{"type":"integer","minimum":0.0,"title":"Current Strikes","description":"Strikes actuales"},"is_banned":{"type":"boolean","title":"Is Banned","description":"Si está baneado"},"violations":{"items":{"$ref":"#/components/schemas/ViolationInfo"},"type":"array","title":"Violations","description":"Lista de violaciones"}},"type":"object","required":["user_id","channel_id","total_violations","current_strikes","is_banned"],"title":"UserViolationsResponse","description":"Response con historial de violaciones","example":{"channel_id":"channel_abc","current_strikes":3,"is_banned":false,"total_violations":4,"user_id":"user_789","violations":[{"action_taken":"warning","detected_words":["idiota"],"id":"65f1a2b3c4d5e6f7g8h9i0j1","message_id":"msg_123","severity":"medium","strike_count_at_time":1,"timestamp":"2025-10-13T10:30:00Z","toxicity_score":0.75}]}},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"},"ViolationInfo":{"properties":{"id":{"type":"string","title":"Id","description":"ID de la violación"},"message_id":{"type":"string","title":"Message Id","description":"ID del mensaje"},"detected_words":{"items":{"type":"string"},"type":"array","title":"Detected Words","description":"Palabras detectadas"},"toxicity_score":{"type":"number","maximum":1.0,"minimum":0.0,"title":"Toxicity Score","description":"Score de toxicidad"},"severity":{"type":"string","title":"Severity","description":"Severidad"},"action_taken":{"type":"string","title":"Action Taken","description":"Acción tomada"},"strike_count_at_time":{"type":"integer","minimum":0.0,"title":"Strike Count At Time","description":"Strikes en ese momento"},"timestamp":{"type":"string","title":"Timestamp","description":"Fecha (ISO)"}},"type":"object","required":["id","message_id","toxicity_score","severity","action_taken","strike_count_at_time","timestamp"],"title":"ViolationInfo","description":"Información de violación","example":{"action_taken":"warning","detected_words":["idiota","estúpido"],"id":"65f1a2b3c4d5e6f7g8h9i0j1","message_id":"msg_123","severity":"high","strike_count_at_time":2,"timestamp":"2025-10-13T10:30:00Z","toxicity_score":0.85}},"WordResponse":{"properties":{"id":{"type":"string","title":"Id","description":"ID de la palabra"},"word":{"type":"string","title":"Word","description":"Palabra o patrón"},"language":{"type":"string","title":"Language","description":"Idioma"},"category":{"type":"string","title":"Category","description":"Categoría"},"severity":{"type":"string","title":"Severity","description":"Severidad"},"is_active":{"type":"boolean","title":"Is Active","description":"Si está activa"},"is_regex":{"type":"boolean","title":"Is Regex","description":"Si es regex"},"added_by":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Added By","description":"Agregado por"},"added_at":{"type":"string","title":"Added At","description":"Fecha de creación (ISO)"},"updated_at":{"type":"string","title":"Updated At","description":"Fecha de actualización (ISO)"},"notes":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Notes","description":"Notas"}},"type":"object","required":["id","word","language","category","severity","is_active","is_regex","added_at","updated_at"],"title":"WordResponse","description":"Response con información de palabra","example":{"added_at":"2025-10-13T10:00:00Z","added_by":"admin_123","category":"insult","id":"65f1a2b3c4d5e6f7g8h9i0j1","is_active":true,"is_regex":false,"language":"es","notes":"Insulto común","severity":"medium","updated_at":"2025-10-13T10:00:00Z","word":"idiota"}}}}}