{"openapi":"3.1.0","info":{"title":"Servicio de Presencia","description":"API para registrar, actualizar y consultar el estado de conexión de los usuarios.","version":"0.0.1"},"paths":{"/api/v1.0.0/presence/health":{"get":{"tags":["v1.0.0 - Servicio de presencia"],"summary":"Verifica el estado operativo del servicio de presencia y la conexión a MongoDB","operationId":"health_check_api_v1_0_0_presence_health_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/v1.0.0/presence":{"post":{"tags":["v1.0.0 - Servicio de presencia"],"summary":"Registrar conexión a un usuario.","operationId":"register_presence_api_v1_0_0_presence_post","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserConnection"},"examples":{"from_web":{"summary":"Conexión desde la web","description":"Usuario conectado desde el portal web.","value":{"userId":"12345","device":"web","ip":"192.168.1.1"}},"from_mobile":{"summary":"Conexión desde móvil","description":"Usuario conectado desde la aplicación móvil.","value":{"userId":"67890","device":"mobile","ip":"10.0.0.5"}},"without_device":{"summary":"Dispositivo no especificado","description":"Usuario conectado sin indicar dispositivo.","value":{"userId":"24680"}}}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"get":{"tags":["v1.0.0 - Servicio de presencia"],"summary":"Lista todos los usuarios con su estado de presencia","operationId":"list_users_api_v1_0_0_presence_get","parameters":[{"name":"status","in":"query","required":false,"schema":{"anyOf":[{"$ref":"#/components/schemas/StatusEnum"},{"type":"null"}],"title":"Status"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1.0.0/presence/stats":{"get":{"tags":["v1.0.0 - Servicio de presencia"],"summary":"Devuelve estadísticas agregadas de presencia, incluyendo usuarios online y offline","operationId":"get_presence_stats_api_v1_0_0_presence_stats_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/v1.0.0/presence/{userId}":{"get":{"tags":["v1.0.0 - Servicio de presencia"],"summary":"Obtiene la información de presencia de un usuario específico por su ID","operationId":"get_user_presence_api_v1_0_0_presence__userId__get","parameters":[{"name":"userId","in":"path","required":true,"schema":{"type":"string","title":"Userid"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"patch":{"tags":["v1.0.0 - Servicio de presencia"],"summary":"Actualiza el estado de un usuario (online/offline) o actualiza su última vez visto","operationId":"update_presence_api_v1_0_0_presence__userId__patch","parameters":[{"name":"userId","in":"path","required":true,"schema":{"type":"string","title":"Userid"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserStatusUpdate"},"examples":{"set_offline":{"summary":"Cambiar estado a offline","description":"El usuario se desconecta explícitamente.","value":{"status":"offline"}},"set_online":{"summary":"Cambiar estado a online","description":"El usuario vuelve a conectarse manualmente.","value":{"status":"online"}},"heartbeat_signal":{"summary":"Enviar heartbeat","description":"Refresca la última conexión del usuario (lastSeen), esto NO actualiza su status.","value":{"heartbeat":true}},"invalid_both":{"summary":"Error por enviar ambos campos","description":"Ejemplo inválido: no se pueden enviar `status` y `heartbeat` juntos.","value":{"status":"offline","heartbeat":true}}}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"delete":{"tags":["v1.0.0 - Servicio de presencia"],"summary":"Elimina la información de presencia de un usuario de la base de datos","operationId":"delete_presence_api_v1_0_0_presence__userId__delete","parameters":[{"name":"userId","in":"path","required":true,"schema":{"type":"string","title":"Userid"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}}},"components":{"schemas":{"DeviceEnum":{"type":"string","enum":["web","mobile","desktop","unknown"],"title":"DeviceEnum"},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"StatusEnum":{"type":"string","enum":["online","offline"],"title":"StatusEnum"},"UserConnection":{"properties":{"userId":{"type":"string","title":"Userid"},"device":{"anyOf":[{"$ref":"#/components/schemas/DeviceEnum"},{"type":"null"}],"default":"unknown"},"ip":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Ip"}},"type":"object","required":["userId"],"title":"UserConnection"},"UserStatusUpdate":{"properties":{"status":{"anyOf":[{"$ref":"#/components/schemas/StatusEnum"},{"type":"null"}]},"heartbeat":{"anyOf":[{"type":"boolean"},{"type":"null"}],"title":"Heartbeat","default":false}},"type":"object","title":"UserStatusUpdate"},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"}}}}